{% extends 'base.html' %}

{% block title %}CTD профиль {{ profile.profile_id }} - Система наблюдений{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>CTD профиль #{{ profile.profile_id }}</h1>
    <a href="{% url 'oceanography:ctd_profile_list' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Назад к списку
    </a>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Информация о профиле</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <th>Станция:</th>
                        <td>{{ profile.station.station_name }}</td>
                    </tr>
                    <tr>
                        <th>Экспедиция:</th>
                        <td>{{ profile.station.expedition.platform }}</td>
                    </tr>
                    <tr>
                        <th>Зонд:</th>
                        <td>{{ profile.probe.probe_name }}</td>
                    </tr>
                    <tr>
                        <th>Время начала:</th>
                        <td>{{ profile.start_datetime|date:"d.m.Y H:i" }}</td>
                    </tr>
                    <tr>
                        <th>Время окончания:</th>
                        <td>{{ profile.end_datetime|date:"d.m.Y H:i" }}</td>
                    </tr>
                    <tr>
                        <th>Макс. глубина:</th>
                        <td>{{ profile.max_depth }} м</td>
                    </tr>
                    <tr>
                        <th>Кол-во измерений:</th>
                        <td>{{ measurements_count }}</td>
                    </tr>
                    {% if profile.data_file %}
                    <tr>
                        <th>Файл данных:</th>
                        <td>{{ profile.data_file.name }}</td>
                    </tr>
                    {% endif %}
                </table>
                
                {% if profile.comment %}
                <div class="mt-3">
                    <strong>Комментарий:</strong>
                    <p class="mb-0">{{ profile.comment }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Статистика профиля</h5>
            </div>
            <div class="card-body">
                {% if depth_range %}
                <table class="table table-sm">
                    <tr>
                        <th>Диапазон глубин:</th>
                        <td>{{ depth_range.min }} - {{ depth_range.max }} м</td>
                    </tr>
                    <tr>
                        <th>Диапазон температур:</th>
                        <td>
                            {% if temp_range.min %}{{ temp_range.min }}{% else %}—{% endif %} - 
                            {% if temp_range.max %}{{ temp_range.max }}{% else %}—{% endif %} °C
                        </td>
                    </tr>
                    <tr>
                        <th>Диапазон солености:</th>
                        <td>
                            {% if salinity_range.min %}{{ salinity_range.min }}{% else %}—{% endif %} - 
                            {% if salinity_range.max %}{{ salinity_range.max }}{% else %}—{% endif %} PSU
                        </td>
                    </tr>
                </table>
                {% else %}
                <p class="text-muted">Нет данных измерений</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if measurements %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Измерения профиля</h5>
        <small>Всего: {{ measurements_count }}</small>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Глубина (м)</th>
                        <th>Время</th>
                        <th>Температура (°C)</th>
                        <th>Соленость (PSU)</th>
                        <th>Кислород (мг/л)</th>
                        <th>Мутность (NTU)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for measurement in measurements %}
                    <tr>
                        <td>{{ measurement.depth_m }}</td>
                        <td>{{ measurement.datetime|date:"H:i:s" }}</td>
                        <td>{{ measurement.temp_c|default:"—" }}</td>
                        <td>{{ measurement.salinity_psu|default:"—" }}</td>
                        <td>{{ measurement.do_mg_l|default:"—" }}</td>
                        <td>{{ measurement.turbidity_ntu|default:"—" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info">
    <h5>Нет данных измерений</h5>
    <p>Для этого профиля пока не загружены данные измерений.</p>
</div>
{% endif %}
{% endblock %}